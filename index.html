<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†Œë‹¤ìˆ˜ í‚¤ìš°ê¸°</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #f0f8ff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        #game-container {
            background: white;
            width: 420px;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            border: 2px solid #87ceeb;
            position: relative;
            overflow: hidden; /* ì˜¤í”„ë‹ í™”ë©´ì´ íŠ€ì–´ë‚˜ê°€ì§€ ì•Šê²Œ */
        }

        /* 1. ì˜¤í”„ë‹(ì´ë¦„ ì…ë ¥) í™”ë©´ ìŠ¤íƒ€ì¼ */
        #start-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        #name-input {
            padding: 10px;
            font-size: 1rem;
            border: 2px solid #87ceeb;
            border-radius: 5px;
            margin-bottom: 10px;
            width: 60%;
            text-align: center;
        }

        #start-btn {
            padding: 10px 20px;
            background-color: #87ceeb;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1rem;
            cursor: pointer;
        }
        #start-btn:hover { background-color: #00bfff; }

        /* ê¸°ì¡´ ê²Œì„ UI ìŠ¤íƒ€ì¼ */
        #status-bar {
            display: flex; justify-content: space-between;
            background-color: #e3f2fd; padding: 10px;
            border-radius: 8px; margin-bottom: 15px;
            font-weight: bold; color: #555; font-size: 0.9rem;
        }
        #inventory-box {
            background-color: #fafafa; border: 1px dashed #ccc;
            padding: 5px; font-size: 0.8rem; min-height: 20px;
            margin-bottom: 10px; color: #666; text-align: left;
        }
        #scene-image {
            width: 100%; height: 220px; object-fit: contain;
            background-color: #eee; border-radius: 10px; margin-bottom: 15px;
        }
        #story-text {
            font-size: 1.1rem; margin-bottom: 20px; min-height: 50px;
            color: #333; line-height: 1.5;
        }
        .choice-btn {
            display: block; width: 100%; padding: 12px; margin: 8px 0;
            background-color: #87ceeb; color: white; border: none;
            border-radius: 8px; font-size: 1rem; cursor: pointer;
            transition: background 0.2s;
        }
        .choice-btn:hover { background-color: #00bfff; }
        
        /* íŠ¹ìˆ˜ ì•„ì´í…œ ë²„íŠ¼ ìƒ‰ìƒ */
        .special-btn { background-color: #98fb98; color: #006400; font-weight: bold; }
        .special-btn:hover { background-color: #32cd32; }

        .event-alert { animation: shake 0.5s; border-color: #ff9800 !important; }
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="start-screen">
            <h2 style="color:#87ceeb;">ì†Œë‹¤ìˆ˜ í‚¤ìš°ê¸°</h2>
            <p>ì§‘ì‚¬ì˜ ì´ë¦„ì„ ì•Œë ¤ì£¼ì„¸ìš”!</p>
            <input type="text" id="name-input" placeholder="ì´ë¦„ ì…ë ¥" autocomplete="off">
            <button id="start-btn" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
        </div>

        <div id="status-bar">
            <span id="stat-intimacy">â¤ï¸ í˜¸ê°ë„: 0</span>
            <span id="stat-money">ğŸ’° ì½”ì¸: 500</span>
        </div>

        <div id="inventory-box">
            ğŸ’ ê°€ë°©: <span id="inventory-list">ë¹„ì–´ìˆìŒ</span>
        </div>

        <img id="scene-image" src="" alt="ì¥ë©´ ì´ë¯¸ì§€">
        <div id="story-text"></div>
        <div id="choices"></div>
    </div>

    <script>
        // 1. ê²Œì„ ìƒíƒœ (ì´ë¦„ ì¶”ê°€)
        let gameState = {
            playerName: "", // í”Œë ˆì´ì–´ ì´ë¦„ ì €ì¥
            intimacy: 0,
            money: 500,
            inventory: []
        };

        const randomEvents = [
            { id: "evt_money", type: "random", probability: 1, sceneData: { text: "ì‚°ì±… ì¤‘ 100ì›ì„ ì£¼ì› ìŠµë‹ˆë‹¤!", image: "images/coin_event.png", choices: [{ text: "ì¢‹ë‹¤!", next: "living_room", effect: () => updateStat('money', 100) }] } },
            { id: "evt_rain", type: "random", probability: 1, sceneData: { text: "ì†Œë‚˜ê¸°ê°€ ë‚´ë¦½ë‹ˆë‹¤. ì†Œë‹¤ìˆ˜ê°€ ì‹œì›í•´í•©ë‹ˆë‹¤.", image: "images/rain_event.png", choices: [{ text: "ì§‘ìœ¼ë¡œ", next: "living_room", effect: () => updateStat('intimacy', 5) }] } }
        ];

        // 2. ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„°
        const scenes = {
            'start': {
                text: "ê¸¸ê°€ì— ì¢…ì´ ë°•ìŠ¤ê°€ ë©ê·¸ëŸ¬ë‹ˆ ë†“ì—¬ì ¸ìˆìŠµë‹ˆë‹¤. ê·¸ ì•ˆì—ëŠ” ì†Œë‹¤ìˆ˜ê°€ ë“¤ì–´ìˆìŠµë‹ˆë‹¤. ì–´ë–»ê²Œ í• ê¹Œìš”?",
                image: "images/start.png",
                choices: [
                    { text: "ì†Œë‹¤ìˆ˜ë¥¼ ë°ë ¤ê°„ë‹¤", next: "hatch", effect: () => updateStat('intimacy', 10) },
                    // [ë³€ê²½ë¨] nextë¥¼ 'ending_ignore'ë¡œ ë³€ê²½í•˜ì—¬ ë°”ë¡œ ì—”ë”©ìœ¼ë¡œ ì´ë™
                    { text: "ê·¸ëƒ¥ ì§€ë‚˜ê°„ë‹¤", next: "ending_ignore" } 
                ]
            },
            
            // [ì¶”ê°€ë¨] ë¬´ì‹œí•˜ê¸° ì—”ë”© ì¥ë©´
            'ending_ignore': {
                text: "ë‹¹ì‹ ì€ ë°•ìŠ¤ë¥¼ ì™¸ë©´í•˜ê³  ì§€ë‚˜ì³¤ìŠµë‹ˆë‹¤. ë©°ì¹  ë’¤ ê·¸ê³³ì—” ë¹ˆ ë°•ìŠ¤ë§Œ ë‚¨ì•„ìˆì—ˆìŠµë‹ˆë‹¤... (ë…¸ë§ ì—”ë”©)",
                image: "images/empty_box.png", // ë¹ˆ ë°•ìŠ¤ ì´ë¯¸ì§€ê°€ ìˆë‹¤ë©´ ì„¤ì •, ì—†ìœ¼ë©´ ê¸°ì¡´ ì´ë¯¸ì§€ ì‚¬ìš©
                choices: [
                    { text: "ë‹¤ì‹œ ì‹œì‘í•˜ê¸°", next: "title", effect: showTitleScreen }
                ]
            },

            'hatch': {
                text: "ì†Œë‹¤ìˆ˜ëŠ” ì§‘ì„ ë‘ë¦¬ë²ˆê±°ë¦½ë‹ˆë‹¤.",
                image: "images/baby.png",
                choices: [{ text: "ê±°ì‹¤ë¡œ ë°ë ¤ê°€ê¸°", next: "living_room" }]
            },
            
            'living_room': {
                text: "ê±°ì‹¤ì…ë‹ˆë‹¤. ì†Œë‹¤ìˆ˜ëŠ” ë‹¹ì‹ ì„ ë°”ë¼ë³´ê³  ìˆìŠµë‹ˆë‹¤.",
                image: "images/room.png",
                choices: [
                    // ì´ìŠ¤í„°ì—ê·¸ ì•„ì´í…œ ì‚¬ìš© ë²„íŠ¼ (ì¡°ê±´ë¶€ ë“±ì¥)
                    { 
                        text: "âœ¨ 'ìˆ˜ì‹ ë©”ë¡ ' ë¨¹ì´ê¸° (ì „ì„¤ì˜ ê°„ì‹!)", 
                        next: "eat_melon", 
                        customClass: "special-btn",
                        req: () => gameState.inventory.includes("ìˆ˜ì‹ ë©”ë¡ "), // ì•„ì´í…œì´ ìˆì–´ì•¼ë§Œ ë³´ì„
                        effect: () => { useItem("ìˆ˜ì‹ ë©”ë¡ "); updateStat('intimacy', 100); } // ì‚¬ìš© ì‹œ ì†Œëª¨ë¨
                    },
                    { text: "ë†€ì•„ì£¼ê¸° (í˜¸ê°ë„+5, ì½”ì¸-50)", next: "play", effect: () => { updateStat('intimacy', 5); updateStat('money', -50); } },
                    { text: "ì‚°ì±… ë‚˜ê°€ê¸° (ëœë¤)", next: "", customClass: "shop-btn", effect: () => tryRandomEvent() },
                    { text: "ìƒì  ê°€ê¸°", next: "shop" },
                    { text: "ì—”ë”© í™•ì¸", next: "check_ending" }
                ]
            },
            'eat_melon': {
                text: "ì†Œë‹¤ìˆ˜ê°€ ìˆ˜ì‹ ë©”ë¡ ì„ ë¨¹ê³  ì—„ì²­ë‚œ í–‰ë³µì„ ëŠë‚ë‹ˆë‹¤! ê¸°í¬ê°€ í­ì£½ì²˜ëŸ¼ í„°ì§‘ë‹ˆë‹¤! (í˜¸ê°ë„ ëŒ€í­ ìƒìŠ¹)",
                image: "images/melon_eat.png",
                choices: [{ text: "íë­‡í•˜ê²Œ ë°”ë¼ë³¸ë‹¤", next: "living_room" }]
            },
            'play': {
                text: "ì¦ê±°ìš´ ì‹œê°„ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.",
                image: "images/play.png",
                choices: [{ text: "ë‹¤ì‹œ ê±°ì‹¤ë¡œ", next: "living_room" }]
            },
            'shop': {
                text: "í¸ì˜ì ì…ë‹ˆë‹¤.",
                image: "images/shop.png",
                choices: [
                    { 
                        text: "ì„ ê¸€ë¼ìŠ¤ êµ¬ë§¤ (400ì½”ì¸)", next: "shop",
                        req: () => gameState.money >= 400 && !gameState.inventory.includes("ì„ ê¸€ë¼ìŠ¤"),
                        effect: () => { updateStat('money', -400); addItem("ì„ ê¸€ë¼ìŠ¤"); }
                    },
                    { text: "ëŒì•„ê°€ê¸°", next: "living_room" }
                ]
            },
            'check_ending': {
                text: "ì„±ì¥ì˜ ì‹œê°„ì…ë‹ˆë‹¤...",
                image: "images/evolution.png",
                choices: [{ text: "ê²°ê³¼ ë³´ê¸°", next: "", effect: () => checkEndings() }]
            },
            // ì—”ë”©ë“¤
            'ending_happy': { text: "í•´í”¼ ì—”ë”©: ë ˆì „ë“œ ì‚¬ì´ë‹¤!", image: "images/happy_end.png", choices: [{text:"ë‹¤ì‹œí•˜ê¸°", next:"title", effect:showTitleScreen}] }, // ë‹¤ì‹œí•˜ê¸° ì‹œ íƒ€ì´í‹€ë¡œ
            'ending_bad': { text: "ë°°ë“œ ì—”ë”©: ë§¹ë¬¼...", image: "images/bad_end.png", choices: [{text:"ë‹¤ì‹œí•˜ê¸°", next:"title", effect:showTitleScreen}] },
            'ending_cool': { text: "íˆë“  ì—”ë”©: í™í•© ìŠ¤íƒ€!", image: "images/cool_end.png", choices: [{text:"ë‹¤ì‹œí•˜ê¸°", next:"title", effect:showTitleScreen}] }
        };

        // 3. ì—”ì§„ í•¨ìˆ˜ë“¤
        const imageEl = document.getElementById('scene-image');
        const textEl = document.getElementById('story-text');
        const choicesEl = document.getElementById('choices');
        const startScreen = document.getElementById('start-screen');
        const nameInput = document.getElementById('name-input');

        // --- í•µì‹¬: ê²Œì„ ì‹œì‘ ë° ì´ìŠ¤í„°ì—ê·¸ ì²´í¬ ---
        function startGame() {
            const inputName = nameInput.value.trim();
            if (!inputName) {
                alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            // ì´ˆê¸°í™”
            gameState = {
                playerName: inputName,
                intimacy: 0,
                money: 500,
                inventory: []
            };

            // ì´ìŠ¤í„°ì—ê·¸ ì²´í¬ ë¡œì§
            if (inputName === "ì˜¤ì…˜") {
                alert("'ìˆ˜ì‹ ë©”ë¡ 'ì„ íšë“í–ˆìŠµë‹ˆë‹¤.");
                gameState.inventory.push("ìˆ˜ì‹ ë©”ë¡ ");
            }

            startScreen.style.display = "none"; // ì‹œì‘ í™”ë©´ ìˆ¨ê¹€
            updateHUD();
            showScene('start');
        }

        function showTitleScreen() {
            startScreen.style.display = "flex"; // ì‹œì‘ í™”ë©´ ë‹¤ì‹œ ë³´ì„
            nameInput.value = ""; // ì…ë ¥ì°½ ì´ˆê¸°í™”
        }
        // ----------------------------------------

        function updateStat(type, amount) {
            gameState[type] += amount;
            updateHUD();
        }

        function addItem(itemName) {
            if(gameState.inventory.includes(itemName)) return;
            gameState.inventory.push(itemName);
            alert(`âœ¨ [${itemName}] íšë“!`);
            updateHUD();
        }

        // ì•„ì´í…œ ì‚¬ìš©(ì†Œëª¨) í•¨ìˆ˜ ì¶”ê°€
        function useItem(itemName) {
            const index = gameState.inventory.indexOf(itemName);
            if (index > -1) {
                gameState.inventory.splice(index, 1); // ë°°ì—´ì—ì„œ ì‚­ì œ
                updateHUD();
            }
        }

        function updateHUD() {
            document.getElementById('stat-intimacy').innerText = `â¤ï¸ í˜¸ê°ë„: ${gameState.intimacy}`;
            document.getElementById('stat-money').innerText = `ğŸ’° ì½”ì¸: ${gameState.money}`;
            const invList = document.getElementById('inventory-list');
            invList.innerText = gameState.inventory.length === 0 ? "ë¹„ì–´ìˆìŒ" : gameState.inventory.join(", ");
        }

        function tryRandomEvent() {
            let candidates = randomEvents.filter(evt => {
                if (evt.type === 'random') return true;
                if (evt.type === 'condition' && evt.req()) return true;
                return false;
            });

            if (candidates.length === 0) {
                showSceneRaw({ text: "ì•„ë¬´ ì¼ë„ ì—†ì—ˆìŠµë‹ˆë‹¤.", image: "images/walk_normal.png", choices: [{ text: "ì§‘ìœ¼ë¡œ", next: "living_room" }] });
                return;
            }

            const selectedEvent = candidates[Math.floor(Math.random() * candidates.length)];
            document.getElementById('game-container').classList.add('event-alert');
            setTimeout(() => document.getElementById('game-container').classList.remove('event-alert'), 500);
            showSceneRaw(selectedEvent.sceneData);
        }

        function showSceneRaw(sceneData) {
            // í…ìŠ¤íŠ¸ì— í”Œë ˆì´ì–´ ì´ë¦„ ë°˜ì˜ (ì˜ˆ: {name}ì„ ì´ë¦„ìœ¼ë¡œ ì¹˜í™˜)
            let processedText = sceneData.text.replace("{name}", gameState.playerName);
            textEl.innerText = processedText;

            if (sceneData.image) {
                imageEl.src = sceneData.image;
                imageEl.onerror = function() { this.style.backgroundColor = '#ddd'; this.alt = "ì´ë¯¸ì§€ ì—†ìŒ"; };
            }
            choicesEl.innerHTML = '';
            
            sceneData.choices.forEach(choice => {
                if (choice.req && !choice.req()) return;

                const btn = document.createElement('button');
                btn.innerText = choice.text;
                btn.className = 'choice-btn';
                if (choice.customClass) btn.classList.add(choice.customClass);
                
                btn.onclick = () => {
                    if (choice.effect) choice.effect();
                    if (choice.next) {
                        if(choice.next === 'title') showTitleScreen();
                        else showScene(choice.next);
                    }
                };
                choicesEl.appendChild(btn);
            });
        }

        function showScene(sceneId) {
            if(!scenes[sceneId]) return;
            showSceneRaw(scenes[sceneId]);
        }

        function checkEndings() {
            if(gameState.inventory.includes("ì„ ê¸€ë¼ìŠ¤")) showScene("ending_cool");
            else if(gameState.intimacy >= 50) showScene("ending_happy");
            else showScene("ending_bad");
        }

        // ì´ˆê¸° ì‹¤í–‰ì€ ì´ì œ startGame()ì´ ë‹´ë‹¹í•˜ë¯€ë¡œ ì—¬ê¸°ì„  HUDë§Œ ì´ˆê¸°í™”
        updateHUD();

    </script>
</body>
</html>
